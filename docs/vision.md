# Vision - 展望

# 新しい記事

このプロジェクトは、（仕様のあいまいさを積極的に包容していることで賛否がある） `.kif` ファイルの **将棋ソフト開発者の新規参入が難しい現状** を打開するための方法の提案と、その方法を実装している途中の パーサーです。  
`.kif` は、本将棋の棋譜のファイル フォーマットです。  

例えば もし lishogi とか どこかが どんなにすばらしい新しい棋譜の規格を立てたとしても、 将棋連盟の棋譜中継などでも使われている 柿木将棋でそれに対応していなければ 流行りません。  
欲しいのは すでに世間に定着している 既成のソフトへ読込ませることができ、既成のソフトが書き出したものを読み取れる　棋譜ファイルです。  
.kif ファイルとは、データ交換のための形式という面よりも、　既成ソフトに入出力できるインターフェースの面が強いです。  

コンセントの形が違うとき、プラグの方の形を変えるというのはよくあります。  
既成のコンセントの方を変えるのは困難ですから、注力すべきは　プラグの方です。  

作戦名は `パロッティング作戦` です。（parroting another's words でオウム返し）  

アイデアとしては `.kif` ファイルの内容を解析するのではなく、 `.kif` ファイルの書式の方を解析し、 `ローカル .kif 仕様書` とでもいうようなものを生成（TODO この部分がまだできていません）、  
この仕様書を自動生成するツールと、 `ローカル .kif 仕様書` に従って `.kif` ファイルの解析をするツールの２つを **新規の将棋ソフト開発者** にオープンソース、フリーウェアで配ってしまえば、  
「ソフトAで作った `.kif` ファイルがあなたの作った将棋ソフトで読めません」「あなたのソフトで作った `.kif` ファイルは A というソフトで読めません」という責任を  
この muzudho/kif-parser に丸投げできるという段取りです。  

その **書式の解析** をする方法としては、ソフトA に `.kif` ファイルを出力させます。  
muzudho/kif-parser が その `.kif` の書式を解析します。（TODO この部分がまだできていません）  
ソフトA が出力した書式の `.kif` を ソフトA が読込めないというのは考えづらいことから、 ソフトA が読込める `.kif` を生成できるはずです。  
これで ソフトA は攻略です。 これを出会った全ソフトに対して行えば打開完了です。  

こうなってくれば、 `.kif` (Shift-JIS) を変換した `.kifu` (UTF-8) を使い続けても問題ありません。  
これは時間稼ぎで、何かしらの **プロパティファイル** 、例えば `.json` など 構文が厳密な仕様にスライドするのが適当ですが、  
既存のソフトが 仕様の固まっていない JSON に対応するとも思えません。ひとまず時間稼ぎです。  

muzudho/kif-parser の内部では `.json` を使い始めています。  
移行先（その２）のプロパティファイルには `.toml` を考えています。  

# 古い記事
## Overview - 全体図

![20211001shogi2.png](../docs/img/20211001shogi2.png)  

* どの形式のファイルも、 PIVOT （中間）ファイルに変換できるものとし、また、 PIVOT から元の形式に戻せるものとします
  * ただし `.kif` ファイルは PIVOT に直接変換せず、 `.kifu` 変換を経由するものとします

## Proposal - 提案

そこで 2021年現在、人気の高いプログラム言語の Python, Java Script で標準で実装されている JSON ファイル形式を  
中心に据え直し、 `.kif` へエクスポートできるアルゴリズムを Work in progress (作業中)です。  

### .json

![20211002shogi3-50per.png](../docs/img/20211002shogi3-50per.png)  
👆 `.json` ファイル。 仕様は未定

意味解析せず、 `.kif` の１行１行を **直訳** したもの。  
単一行コメントを どの行、どの文末にも置けることから、  
このコメントが上に係っているのか　下に係っているのか　機械的に判断できないため。  

また、 どのソフトから読み取った `.kif` ファイルなのか類推して情報として付加しておくと  
開発時のテストで役に立つかもしれません。  

### .toml

また、もっと ハードコアな開発者向けに、 `.toml` 形式も先行して準備します。  
コメント、文字列型、ヒアドキュメント、整数型、浮動小数点型、時刻型やリスト、連想配列など プログラマー寄りの設定ファイル形式です  

![20211002shogi4-per.png](../docs/img/20211002shogi4-per.png)  
👆 `.toml` ファイル。 仕様は未定。  
